<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title></title>
  <style>
    /* Player only, full-viewport video, no extra UI */
    html,body { height:100%; margin:0; background:#000; }
    video#video {
      width:100%; height:100%; display:block; object-fit:contain;
      background:#000;
    }
  </style>
  <!-- Shaka Player compiled library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.6/shaka-player.compiled.js"></script>
</head>
<body>
  <!-- only the video element visible -->
  <video id="video" autoplay muted playsinline></video>

  <script>
  // --- CONFIGURE THESE ---
  // DASH/HLS/CLEARKEY manifest URL:
  const manifestUri = 'https://ak-live-play-dash-backup.jacocdn.com/v1/019980b48d2e1e2b6eeb3512e572b7/019980b49491150752203f291b23c6/main.mpd'; // <- Replace with your manifest URL

  // ClearKey mapping: key ID and key in HEX (no 0x). Replace both with your actual values.
  // Example placeholders (replace them):
  const KEY_ID_HEX  = '519de877958644e1ac98d6dd908c0f0b'; // 16 or 32 bytes depending on key id (hex)
  const KEY_HEX     = '11c1e27c9f414c9aaaf227268d9c0511'; // the actual AES key in hex

  // ------------------------------------------------

  // Convert hex string to lowercase and remove spaces
  function normalizeHex(h) {
    return h.replace(/\s+/g,'').toLowerCase();
  }

  // Create Shaka Player and load content
  (async () => {
    // feature detection
    if (!shaka.Player.isBrowserSupported()) {
      console.error('Shaka Player not supported in this browser.');
      return;
    }

    const video = document.getElementById('video');
    const player = new shaka.Player(video);

    // Log errors
    player.addEventListener('error', (evt) => {
      console.error('Shaka error', evt.detail);
    });

    // Embed ClearKey into Shaka's DRM config.
    // Shaka accepts clearKeys as hex strings keyed by key ID (hex).
    const clearKeys = {};
    clearKeys[ normalizeHex(KEY_ID_HEX) ] = normalizeHex(KEY_HEX);

    // Configure to use our ClearKey and to disable license server flow
    player.configure({
      drm: {
        clearKeys: clearKeys,
        // allowPersistentState: false,
      },
      // We'll disable ABR so we can choose the max-bitrate variant ourselves
      abr: {
        enabled: false
      }
    });

    try {
      // Load content
      await player.load(manifestUri);

      // After load, pick the variant track with the highest bandwidth
      const variantTracks = player.getVariantTracks(); // {bandwidth, language, width, height, id, ...}

      if (variantTracks && variantTracks.length) {
        // choose track with maximum bandwidth
        let best = variantTracks[0];
        for (const t of variantTracks) {
          if ((t.bandwidth || 0) > (best.bandwidth || 0)) best = t;
        }
        // Select it. clearBuffer = true to switch immediately to highest quality
        player.selectVariantTrack(best, /* clearBuffer */ true);
      }

      // Start playback if not already playing (autoplay may be blocked by browser)
      try { await video.play(); } catch (e) { /* autoplay blocked â€” user interaction required */ }

    } catch (err) {
      console.error('Error loading or setting up playback', err);
    }
  })();
  </script>
</body>
</html>
